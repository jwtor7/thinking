<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Thinking Monitor - Claude Code</title>
  <link rel="stylesheet" href="css/main.css">
</head>
<body>
  <!-- Skip Link for Accessibility -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <!-- Live region for status announcements (screen readers) -->
  <div id="status-announcer" class="sr-only" aria-live="polite" aria-atomic="true"></div>

  <div class="app">
    <!-- Header -->
    <header class="header" role="banner">
      <h1 class="header-title">THINKING MONITOR</h1>
      <div class="header-controls">
        <span id="connection-status" class="status status-disconnected">
          <span class="status-dot"></span>
          <span class="status-text">Disconnected</span>
        </span>
        <button id="export-btn" class="btn btn-icon" title="Export as Markdown (Cmd+E)" aria-label="Export as Markdown">
          <span class="btn-icon-export">&#8595;</span>
        </button>
        <label class="toggle" title="Automatically scroll to latest content when new events arrive">
          <input type="checkbox" id="auto-scroll" checked>
          <span class="toggle-label">Auto-scroll</span>
        </label>
        <div class="header-spacer"></div>
        <div id="theme-toggle-container" class="header-control"></div>
      </div>
    </header>

    <!-- Main Content - Single Column Panel Layout -->
    <main id="main-content" class="panels" role="main" aria-label="Dashboard panels">
        <!-- Thinking Panel -->
        <section class="panel panel-thinking" aria-labelledby="thinking-panel-title">
          <header class="panel-header">
            <button class="panel-collapse-btn" data-panel="thinking" aria-expanded="true" aria-label="Collapse Thinking panel" title="Collapse panel (Shift+T)">
              <span class="panel-collapse-icon">&#9660;</span>
            </button>
            <h2 class="panel-title" id="thinking-panel-title">THINKING</h2>
            <div class="panel-header-controls">
              <div class="panel-filter">
                <input type="text" class="panel-filter-input" id="thinking-filter" placeholder="Filter..." aria-label="Filter thinking entries">
                <button class="panel-filter-clear panel-filter-hidden" id="thinking-filter-clear" aria-label="Clear filter">x</button>
              </div>
              <span class="panel-badge" id="thinking-count">0</span>
            </div>
          </header>
          <div class="panel-content" id="thinking-content">
            <div class="empty-state">
              <div class="empty-state-icon">&#129504;</div>
              <p class="empty-state-title">Waiting for Claude Code session...</p>
              <p class="empty-state-subtitle">Start a conversation in your terminal to see thinking blocks.</p>
            </div>
          </div>
        </section>

        <!-- Tool Activity Panel -->
        <section class="panel panel-tools" aria-labelledby="tools-panel-title">
          <header class="panel-header">
            <button class="panel-collapse-btn" data-panel="tools" aria-expanded="true" aria-label="Collapse Tools panel" title="Collapse panel (Shift+O)">
              <span class="panel-collapse-icon">&#9660;</span>
            </button>
            <h2 class="panel-title" id="tools-panel-title">TOOL ACTIVITY</h2>
            <div class="panel-header-controls">
              <div id="tool-duration-histogram" class="duration-histogram"></div>
              <div class="panel-filter">
                <input type="text" class="panel-filter-input" id="tools-filter" placeholder="Filter..." aria-label="Filter tool entries">
                <button class="panel-filter-clear panel-filter-hidden" id="tools-filter-clear" aria-label="Clear filter">x</button>
              </div>
              <span class="panel-badge" id="tools-count">0</span>
            </div>
          </header>
          <div class="panel-content" id="tools-content">
            <div class="empty-state">
              <div class="empty-state-icon">&#128295;</div>
              <p class="empty-state-title">No tool calls yet</p>
              <p class="empty-state-subtitle">Tools appear when Claude reads files, runs commands, edits code, or searches.</p>
            </div>
          </div>
        </section>

        <!-- Hooks Panel -->
        <section class="panel panel-hooks panel-hidden" aria-labelledby="hooks-panel-title">
          <header class="panel-header">
            <button class="panel-collapse-btn" data-panel="hooks" aria-expanded="true" aria-label="Collapse Hooks panel" title="Collapse panel (Shift+H)">
              <span class="panel-collapse-icon">&#9660;</span>
            </button>
            <h2 class="panel-title" id="hooks-panel-title">HOOKS</h2>
            <div class="panel-header-controls">
              <select class="hook-filter-select" id="hooks-filter" aria-label="Filter hooks">
                <option value="all">All</option>
                <option value="allow">Allow</option>
                <option value="deny">Deny</option>
                <option value="pre">PreToolUse</option>
                <option value="post">PostToolUse</option>
                <option value="subagent">Subagents</option>
                <option value="teammate">TeammateIdle</option>
                <option value="task">TaskCompleted</option>
                <option value="team-all">Team Events</option>
                <option value="deny-subagent">Deny + Subagents</option>
              </select>
              <span class="panel-badge" id="hooks-count">0</span>
            </div>
          </header>
          <div class="panel-content" id="hooks-content">
            <div class="empty-state">
              <div class="empty-state-icon">&#9881;</div>
              <p class="empty-state-title">No hook activity</p>
              <p class="empty-state-subtitle">Hooks run before/after tool execution to enforce rules and track behavior.</p>
            </div>
          </div>
        </section>

        <!-- Team Panel (hidden until team events arrive) -->
        <section class="panel panel-team panel-hidden" aria-labelledby="team-panel-title">
          <header class="panel-header">
            <button class="panel-collapse-btn" data-panel="team" aria-expanded="true" aria-label="Collapse Team panel" title="Collapse panel (Shift+M)">
              <span class="panel-collapse-icon">&#9660;</span>
            </button>
            <h2 class="panel-title" id="team-panel-title">TEAM <span class="team-name-badge" id="team-name"></span></h2>
            <div class="panel-header-controls">
              <span class="panel-badge" id="team-count">0</span>
            </div>
          </header>
          <div class="panel-content" id="team-content">
            <div class="team-layout">
              <div class="team-member-section team-section" id="team-member-section">
                <button
                  class="team-section-toggle"
                  id="team-member-toggle"
                  data-team-section="members"
                  type="button"
                  aria-expanded="true"
                  aria-label="Collapse team members section"
                  title="Collapse section"
                >
                  <span class="team-section-label">MEMBERS</span>
                  <span class="team-section-chevron">&#9660;</span>
                </button>
                <div class="team-member-grid team-section-body" id="team-member-grid">
                  <div class="empty-state">
                    <div class="empty-state-icon">&#128101;</div>
                    <p class="empty-state-title">No team activity</p>
                    <p class="empty-state-subtitle">Teams appear when Claude uses TeamCreate and SendMessage for multi-agent collaboration.</p>
                  </div>
                </div>
              </div>
              <div class="team-agent-tree-section team-section team-section-no-data" id="agent-tree-section">
                <button
                  class="team-section-toggle"
                  id="agent-tree-toggle"
                  data-team-section="hierarchy"
                  type="button"
                  aria-expanded="true"
                  aria-label="Collapse agent hierarchy section"
                  title="Collapse section"
                >
                  <span class="team-section-label">AGENT HIERARCHY</span>
                  <span class="team-section-chevron">&#9660;</span>
                </button>
                <div class="agent-tree-content team-section-body" id="agent-tree-content"></div>
              </div>
              <div class="team-messages-section">
                <div class="team-section-label">MESSAGES</div>
                <div class="team-messages" id="team-messages">
                  <div class="empty-state">
                    <div class="empty-state-icon">&#128172;</div>
                    <p class="empty-state-title">No messages yet</p>
                    <p class="empty-state-subtitle">Messages appear when agents communicate via SendMessage.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Tasks Panel (hidden until task events arrive) -->
        <section class="panel panel-tasks panel-hidden" aria-labelledby="tasks-panel-title">
          <header class="panel-header">
            <button class="panel-collapse-btn" data-panel="tasks" aria-expanded="true" aria-label="Collapse Tasks panel" title="Collapse panel (Shift+K)">
              <span class="panel-collapse-icon">&#9660;</span>
            </button>
            <h2 class="panel-title" id="tasks-panel-title">TASKS</h2>
            <div class="panel-header-controls">
              <span class="panel-badge" id="tasks-total-count">0</span>
            </div>
          </header>
          <div class="panel-content" id="tasks-content">
            <div class="task-board">
              <div class="task-column">
                <div class="task-column-header">
                  <span class="task-column-title">Pending</span>
                  <span class="task-column-count" id="tasks-pending-count">0</span>
                </div>
                <div class="task-column-cards" id="tasks-pending">
                  <div class="task-column-empty">No pending tasks</div>
                </div>
              </div>
              <div class="task-column">
                <div class="task-column-header">
                  <span class="task-column-title">In Progress</span>
                  <span class="task-column-count" id="tasks-in-progress-count">0</span>
                </div>
                <div class="task-column-cards" id="tasks-in-progress">
                  <div class="task-column-empty">No active tasks</div>
                </div>
              </div>
              <div class="task-column">
                <div class="task-column-header">
                  <span class="task-column-title">Completed</span>
                  <span class="task-column-count" id="tasks-completed-count">0</span>
                </div>
                <div class="task-column-cards" id="tasks-completed">
                  <div class="task-column-empty">No completed tasks</div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Timeline Panel (chronological view of all events) -->
        <section class="panel panel-timeline panel-hidden" aria-labelledby="timeline-panel-title">
          <header class="panel-header">
            <button class="panel-collapse-btn" data-panel="timeline" aria-expanded="true" aria-label="Collapse Timeline panel" title="Collapse panel (Shift+L)">
              <span class="panel-collapse-icon">&#9660;</span>
            </button>
            <h2 class="panel-title" id="timeline-panel-title">TIMELINE</h2>
            <div class="panel-header-controls">
              <div class="panel-filter">
                <input type="text" class="panel-filter-input" id="timeline-filter" placeholder="Filter..." aria-label="Filter timeline entries">
                <button class="panel-filter-clear panel-filter-hidden" id="timeline-filter-clear" aria-label="Clear filter">x</button>
              </div>
              <span class="panel-badge" id="timeline-count">0</span>
            </div>
          </header>
          <div id="timeline-type-chips" class="timeline-type-chips"></div>
          <div id="timeline-session-chips" class="timeline-session-chips"></div>
          <div class="panel-content" id="timeline-entries">
            <div class="empty-state">
              <div class="empty-state-icon">&#128337;</div>
              <p class="empty-state-title">No events yet</p>
              <p class="empty-state-subtitle">A chronological feed of all events: thinking, tools, hooks, agents, and more.</p>
            </div>
          </div>
        </section>

        <!-- Agents Panel -->
        <section class="panel panel-agents panel-hidden" aria-labelledby="agents-panel-title">
          <header class="panel-header">
            <button class="panel-collapse-btn" data-panel="agents" aria-expanded="true" aria-label="Collapse Agents panel" title="Collapse panel (Shift+A)">
              <span class="panel-collapse-icon">&#9660;</span>
            </button>
            <h2 class="panel-title" id="agents-panel-title">AGENTS</h2>
            <div class="panel-header-controls">
              <span class="panel-badge" id="agents-view-count">0</span>
            </div>
          </header>
          <div class="panel-content agents-layout" id="agents-content">
            <div class="agents-sidebar" id="agents-sidebar">
              <div class="empty-state">
                <div class="empty-state-icon">&#129302;</div>
                <p class="empty-state-title">No agents</p>
                <p class="empty-state-subtitle">Sub-agents will appear here when Claude spawns them.</p>
              </div>
            </div>
            <div class="agents-detail" id="agents-detail">
              <div class="empty-state">
                <div class="empty-state-icon">&#129504;</div>
                <p class="empty-state-title">Select an agent</p>
                <p class="empty-state-subtitle">Click an agent in the sidebar to view its thinking.</p>
              </div>
            </div>
          </div>
        </section>

        <!-- Plan Panel -->
        <section class="panel panel-plan" aria-labelledby="plan-panel-title">
          <header class="panel-header">
            <button class="panel-collapse-btn" data-panel="plan" aria-expanded="true" aria-label="Collapse Plan panel" title="Collapse panel">
              <span class="panel-collapse-icon">&#9660;</span>
            </button>
            <h2 class="panel-title" id="plan-panel-title">PLAN <span class="plan-scope-badge" title="Plans are workspace-level files shared across all sessions">workspace</span></h2>
            <div class="panel-header-controls">
              <div class="plan-actions">
                <button class="plan-action-btn" id="plan-open-btn" title="Open in Default App (Cmd+O)" aria-label="Open in Default App" disabled>
                  <span class="plan-action-icon">&#128196;</span>
                </button>
                <button class="plan-action-btn" id="plan-reveal-btn" title="Reveal in Finder (Cmd+Shift+R)" aria-label="Reveal in Finder" disabled>
                  <span class="plan-action-icon">&#128193;</span>
                </button>
              </div>
              <div class="plan-selector-wrapper">
                <button class="plan-selector-btn" id="plan-selector-btn" aria-haspopup="listbox" aria-expanded="false" title="Select a plan file">
                  <span class="plan-selector-text" id="plan-selector-text">No active plan</span>
                  <span class="plan-selector-arrow">&#9662;</span>
                </button>
                <ul class="plan-selector-dropdown" id="plan-selector-dropdown" role="listbox" aria-label="Available plans">
                  <!-- Plan options will be added dynamically -->
                </ul>
              </div>
            </div>
          </header>
          <div class="plan-meta" id="plan-meta">
            <!-- Plan metadata (last modified, etc.) will be added dynamically -->
          </div>
          <div class="panel-content" id="plan-content">
            <div class="empty-state">
              <div class="empty-state-icon">&#128196;</div>
              <p class="empty-state-title">No plan loaded</p>
              <p class="empty-state-subtitle">Select a plan from the dropdown above.</p>
            </div>
          </div>
        </section>
    </main>

    <div id="stats-bar" class="stats-bar"></div>

    <!-- Connection Overlay -->
    <div class="connection-overlay" id="connection-overlay">
      <div class="connection-overlay-content">
        <div class="connection-overlay-icon">ðŸ”Œ</div>
        <h2 class="connection-overlay-title">Connecting to Server</h2>
        <p class="connection-overlay-message" id="connection-overlay-message">Attempting to connect...</p>
        <button class="connection-overlay-retry" id="connection-overlay-retry">Retry Now</button>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer" role="contentinfo">
      <span id="server-info">Server: --</span>
      <span id="active-session-indicator" class="active-session-indicator" title="Click to select session"></span>
      <span id="activity-pulse" class="activity-pulse" title="Event activity rate"><span class="activity-pulse-dot"></span><span class="activity-pulse-rate"></span></span>
      <span id="event-count">Events: 0</span>
    </footer>
  </div>

  <!-- Plan Context Menu -->
  <div class="plan-context-menu" id="plan-context-menu" role="menu" aria-label="Plan actions">
    <button class="plan-context-menu-item" id="context-menu-open" role="menuitem">
      <span class="plan-context-menu-icon">&#128196;</span>
      Open in Default App
    </button>
    <button class="plan-context-menu-item" id="context-menu-reveal" role="menuitem">
      <span class="plan-context-menu-icon">&#128193;</span>
      Reveal in Finder
    </button>
  </div>

  <!-- Session Context Menu -->
  <div class="session-context-menu" id="session-context-menu" role="menu" aria-label="Session actions">
    <button class="session-context-menu-item" id="session-context-menu-reveal" role="menuitem">
      <span class="session-context-menu-icon">&#128193;</span>
      Reveal in Finder
    </button>
  </div>

  <script src="app.js?v=0.16.0" defer></script>
</body>
</html>
